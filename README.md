# 广告知识图谱系统 MVP

基于用户行为和画像数据构建知识图谱与事理图谱，支撑智能问答和投放策略生成。

## 系统架构

```
┌─────────────────────────────────────────────────────┐
│                   前端 (Vue3 + Element Plus)        │
│  Dashboard | 图谱可视化 | 样本管理 | 智能问答        │
└─────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────┐
│                 后端 (FastAPI)                       │
│  知识图谱服务 | 样本管理 | 事理图谱 | 问答引擎        │
└─────────────────────────────────────────────────────┘
                          │
        ┌─────────────────┴─────────────────┐
        ▼                                   ▼
┌───────────────┐               ┌───────────────────┐
│ Mock数据      │               │ Anthropic API     │
│ (10万用户)    │               │ (GLM/Qwen)        │
└───────────────┘               └───────────────────┘
```

## 功能特性

1. **知识图谱构建**
   - 从用户行为数据抽取实体和关系
   - 支持品牌-车型-兴趣关联分析
   - 可视化图谱展示

2. **样本管理**
   - 支持1:10:5:5样本比例配置
   - 正样本/流失样本/弱兴趣样本/空白对照
   - 统计分析和典型案例提取

3. **事理图谱生成**
   - 基于LLM的因果推理
   - 转化概率和置信度评估
   - 关键发现和投放建议

4. **智能问答**
   - 自然语言理解
   - 基于图谱的推理回答
   - 多维度分析对比

## 快速启动

### 1. 安装后端依赖

```bash
cd backend
pip install -r requirements.txt
```

### 2. 配置环境变量

```bash
cp .env.example .env
# 编辑 .env 文件，填入 Anthropic API Key
```

### 3. 启动后端

```bash
python main.py
# 服务运行在 http://localhost:8000
# API文档: http://localhost:8000/docs
```

### 4. 安装前端依赖

```bash
cd frontend
npm install
```

### 5. 启动前端

```bash
npm run dev
# 前端运行在 http://localhost:5173
```

## API接口

| 接口 | 方法 | 说明 |
|------|------|------|
| `/api/v1/graphs/knowledge/build` | POST | 构建知识图谱 |
| `/api/v1/graphs/knowledge/query` | GET | 查询图谱 |
| `/api/v1/samples/generate` | POST | 生成样本 |
| `/api/v1/qa/event-graph/generate` | POST | 生成事理图谱 |
| `/api/v1/qa/query` | POST | 智能问答 |

## 验证流程

1. **首页**: 点击"构建知识图谱" → "生成样本" → "生成事理图谱"
2. **智能问答**: 输入"喜欢打高尔夫的用户是宝马7系高潜还是奔驰S系高潜？"
3. **图谱可视化**: 查看品牌-兴趣关联图谱

## 示例问题

- "喜欢打高尔夫的用户是宝马7系高潜还是奔驰S系高潜？"
- "高收入人群对豪华轿车的品牌偏好是什么？"
- "什么样的用户容易流失？"
- "针对商务人士应该投放哪些素材？"

## 技术栈

| 层级 | 技术 |
|------|------|
| 前端 | Vue3 + Element Plus + D3.js |
| 后端 | FastAPI + Pydantic |
| LLM | Anthropic API (GLM-4.6-flash / Qwen3-32B) |
| 数据 | Mock (可扩展ClickHouse) |

## 目录结构

```
adsagent/
├── backend/
│   ├── app/
│   │   ├── api/          # API路由
│   │   ├── core/         # 配置和客户端
│   │   ├── services/     # 业务逻辑
│   │   ├── models/       # 数据模型
│   │   └── data/         # Mock数据
│   ├── main.py
│   └── requirements.txt
├── frontend/
│   ├── src/
│   │   ├── views/        # 页面
│   │   ├── components/   # 组件
│   │   └── api/          # API封装
│   └── package.json
└── README.md
```

## 扩展说明

- **数据源**: 可扩展接入ClickHouse用户行为数据
- **图数据库**: 可集成Neo4j/NebulaGraph存储图谱
- **大模型**: 支持切换不同的LLM服务
