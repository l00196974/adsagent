# 非结构化格式测试指南

## 快速测试步骤

### 1. 启动服务

**后端**:
```bash
cd backend
python main.py
```

**前端**:
```bash
cd frontend
npm run dev
```

### 2. 访问页面

打开浏览器访问: http://localhost:5173

进入"基础建模"页面

### 3. 测试行为数据

#### 下载模板
1. 切换到"行为数据"标签
2. 点击"下载模板"按钮
3. 打开下载的 `behavior_template.csv`

#### 查看模板格式
```csv
user_id,timestamp,behavior_text
user_001,2026-01-01 10:00:00,在微信上浏览了BMW 7系的广告，停留了5分钟
user_001,2026-01-01 10:30:00,在汽车之家APP搜索"豪华轿车"
user_001,2026-01-02 14:00:00,在4S店停留了2小时，试驾了BMW 7系
```

#### 导入数据
1. 编辑模板，添加更多数据（可选）
2. 点击"导入CSV"按钮
3. 选择编辑好的 CSV 文件
4. 等待导入成功提示

#### 查看结果
- 表格应该显示 3 列：用户ID、时间戳、行为描述
- "行为描述"列应该显示完整的文本内容
- 如果显示为空，说明有问题

### 4. 测试用户画像

#### 下载模板
1. 切换到"用户画像"标签
2. 点击"下载模板"按钮
3. 打开下载的 `profile_template.csv`

#### 查看模板格式
```csv
user_id,profile_text
user_001,28岁男性，北京工程师，年收入50万，本科学历，喜欢高尔夫和科技产品
user_002,35岁女性，上海设计师，年收入30万，硕士学历，喜欢艺术和旅游
```

#### 导入数据
1. 编辑模板，添加更多数据（可选）
2. 点击"导入CSV"按钮
3. 选择编辑好的 CSV 文件
4. 等待导入成功提示

#### 查看结果
- 表格应该显示 2 列：用户ID、用户画像
- "用户画像"列应该显示完整的文本内容
- 如果显示为空，说明有问题

### 5. 测试事件抽象兼容性

#### 进入事件抽象页面
1. 点击左侧菜单"事件抽象"
2. 找到刚才导入的用户

#### 单用户抽象
1. 找到未抽象的用户（状态显示"未抽象"）
2. 点击"生成"按钮
3. 等待抽象完成
4. 点击"查看"查看抽象结果

#### 批量抽象
1. 点击"批量事件抽象"按钮
2. 确认对话框
3. 观察进度展示
4. 等待完成

#### 验证兼容性
- 非结构化数据应该能正常抽象
- 抽象结果应该合理
- 不应该出现错误

## 常见问题排查

### 问题1: 表格显示为空

**检查后端数据**:
```bash
python3 << 'EOF'
import sys
sys.path.insert(0, '/home/linxiankun/adsagent/backend')
from app.services.base_modeling import BaseModelingService

service = BaseModelingService()

# 查询行为数据
result = service.query_behavior_data(limit=5)
print("行为数据:")
for item in result['items']:
    print(f"  {item}")

# 查询用户画像
result = service.query_user_profiles(limit=5)
print("\n用户画像:")
for item in result['items']:
    print(f"  {item}")
EOF
```

**预期输出**:
- 应该看到 `behavior_text` 和 `profile_text` 字段
- 字段内容应该是完整的文本

**如果字段为空**:
- 检查导入的 CSV 文件格式是否正确
- 检查列名是否匹配（`behavior_text`, `profile_text`）
- 重新导入数据

### 问题2: 导入失败

**检查 CSV 格式**:
- 确保使用 UTF-8 编码
- 确保列名正确（区分大小写）
- 确保没有多余的空行或空列

**查看后端日志**:
```bash
tail -f backend/logs/adsagent.log
```

### 问题3: 事件抽象失败

**检查 LLM 配置**:
- 确保 `.env` 文件中配置了 `OPENAI_API_KEY`
- 确保 API key 有效

**查看错误日志**:
```bash
tail -f backend/logs/adsagent_error.log
```

## 验证清单

- [ ] 行为数据模板下载成功
- [ ] 行为数据导入成功
- [ ] 行为数据表格显示正确（有文本内容）
- [ ] 用户画像模板下载成功
- [ ] 用户画像导入成功
- [ ] 用户画像表格显示正确（有文本内容）
- [ ] 单用户事件抽象成功
- [ ] 批量事件抽象成功
- [ ] 抽象结果合理

## 成功标志

### 行为数据表格
```
用户ID          时间戳                  行为描述
user_001   2026-01-01 10:00:00   在微信上浏览了BMW 7系的广告，停留了5分钟
user_001   2026-01-01 10:30:00   在汽车之家APP搜索"豪华轿车"
```

### 用户画像表格
```
用户ID          用户画像
user_001   28岁男性，北京工程师，年收入50万，本科学历，喜欢高尔夫和科技产品
user_002   35岁女性，上海设计师，年收入30万，硕士学历，喜欢艺术和旅游
```

如果看到以上内容，说明功能正常！
